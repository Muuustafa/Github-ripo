<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Quiz Python</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ========================================
        // ðŸ”¥ CONFIGURATION FIREBASE - Ã€ MODIFIER
        // ========================================
        // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCYjXM6YrfB862p48g6_mYX66C_La0ZsI0",
        authDomain: "quiz-python-isikm.firebaseapp.com",
        projectId: "quiz-python-isikm",
        storageBucket: "quiz-python-isikm.firebasestorage.app",
        messagingSenderId: "559369640769",
        appId: "1:559369640769:web:1ad8cb3d771f134f4d5fc0"
      };
        // Initialiser Firebase
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        const ADMIN_CREDENTIALS = {
          login: 'mustafa',
          password: '14051994'
        };

        function AdminDashboard() {
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [loginInput, setLoginInput] = useState('');
          const [passwordInput, setPasswordInput] = useState('');
          const [results, setResults] = useState([]);
          const [selectedStudent, setSelectedStudent] = useState(null);
          const [filter, setFilter] = useState('all');
          const [classFilter, setClassFilter] = useState('all');
          const [loading, setLoading] = useState(false);

          // ðŸ”¥ Ã‰COUTER LES RÃ‰SULTATS EN TEMPS RÃ‰EL
          useEffect(() => {
            if (isAuthenticated) {
              setLoading(true);
              const unsubscribe = db.collection('results')
                .orderBy('timestamp', 'desc')
                .onSnapshot((snapshot) => {
                  const resultsData = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                  }));
                  setResults(resultsData);
                  setLoading(false);
                }, (error) => {
                  console.error('Erreur Firebase:', error);
                  setLoading(false);
                });

              return () => unsubscribe();
            }
          }, [isAuthenticated]);

          const handleLogin = () => {
            if (loginInput === ADMIN_CREDENTIALS.login && passwordInput === ADMIN_CREDENTIALS.password) {
              setIsAuthenticated(true);
              setLoginInput('');
              setPasswordInput('');
              
              const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
              });
              
              Toast.fire({
                icon: 'success',
                title: 'Connexion rÃ©ussie !',
                text: 'Bienvenue dans le tableau de bord'
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Ã‰chec de connexion',
                text: 'Identifiant ou mot de passe incorrect.',
                confirmButtonColor: '#DC2626'
              });
            }
          };

          const handleLogout = async () => {
            const result = await Swal.fire({
              icon: 'question',
              title: 'DÃ©connexion',
              text: 'Voulez-vous vraiment vous dÃ©connecter ?',
              showCancelButton: true,
              confirmButtonColor: '#DC2626',
              cancelButtonColor: '#6B7280',
              confirmButtonText: 'Oui, dÃ©connecter',
              cancelButtonText: 'Annuler'
            });

            if (result.isConfirmed) {
              setIsAuthenticated(false);
              setSelectedStudent(null);
              
              const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true
              });
              
              Toast.fire({
                icon: 'info',
                title: 'DÃ©connectÃ© avec succÃ¨s'
              });
            }
          };

          const clearAllResults = async () => {
            const result = await Swal.fire({
              icon: 'warning',
              title: 'ÃŠtes-vous sÃ»r ?',
              html: '<p>Vous Ãªtes sur le point de supprimer <strong>TOUS</strong> les rÃ©sultats.</p><p class="text-red-600 font-semibold mt-2">Cette action est IRRÃ‰VERSIBLE !</p>',
              showCancelButton: true,
              confirmButtonColor: '#DC2626',
              cancelButtonColor: '#6B7280',
              confirmButtonText: 'Oui, tout supprimer',
              cancelButtonText: 'Annuler'
            });

            if (result.isConfirmed) {
              try {
                const batch = db.batch();
                const snapshot = await db.collection('results').get();
                snapshot.docs.forEach(doc => {
                  batch.delete(doc.ref);
                });
                await batch.commit();
                
                setSelectedStudent(null);
                
                Swal.fire({
                  icon: 'success',
                  title: 'SupprimÃ© !',
                  text: 'Tous les rÃ©sultats ont Ã©tÃ© supprimÃ©s.',
                  confirmButtonColor: '#10B981'
                });
              } catch (error) {
                Swal.fire({
                  icon: 'error',
                  title: 'Erreur',
                  text: 'Impossible de supprimer les rÃ©sultats.',
                  confirmButtonColor: '#DC2626'
                });
              }
            }
          };

          const exportToCSV = () => {
            if (results.length === 0) {
              Swal.fire({
                icon: 'info',
                title: 'Aucun rÃ©sultat',
                text: 'Il n\'y a aucun rÃ©sultat Ã  exporter.',
                confirmButtonColor: '#4F46E5'
              });
              return;
            }

            const csv = [
              ['Nom Complet', 'Classe', 'Note/20', 'Pourcentage', 'Bonnes RÃ©ponses', 'Total Questions', 'Points Obtenus', 'Points Max', 'Tentatives Triche', 'PÃ©nalitÃ©', 'Date', 'DurÃ©e'],
              ...results.map(r => [
                r.etudiant,
                r.classe,
                r.note,
                r.pourcentage + '%',
                r.correct,
                r.total,
                r.points,
                r.maxPoints,
                r.tentativesTriche,
                r.penalite,
                r.dateTest,
                r.duree
              ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `resultats_quiz_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            const Toast = Swal.mixin({
              toast: true,
              position: 'top-end',
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true
            });
            
            Toast.fire({
              icon: 'success',
              title: `${results.length} rÃ©sultat(s) exportÃ©(s) !`
            });
          };

          const exportDetailedReport = (student) => {
            const report = `
==============================================
RAPPORT DÃ‰TAILLÃ‰ - QUIZ PYTHON
==============================================

INFORMATIONS Ã‰TUDIANT
------------------------------
Nom complet : ${student.etudiant}
Classe : ${student.classe}
Date du test : ${student.dateTest}
DurÃ©e du test : ${student.duree}

RÃ‰SULTATS
------------------------------
Note finale : ${student.note}/20
Pourcentage de rÃ©ussite : ${student.pourcentage}%
RÃ©ponses correctes : ${student.correct}/${student.total}
Points obtenus : ${student.points}/${student.maxPoints}

SYSTÃˆME ANTI-TRICHE
------------------------------
Tentatives dÃ©tectÃ©es : ${student.tentativesTriche}
PÃ©nalitÃ© appliquÃ©e : -${student.penalite} points

${student.tentativesTriche > 0 ? `AVERTISSEMENTS ENREGISTRÃ‰S :
${student.avertissements.map((w, i) => `${i + 1}. ${w}`).join('\n')}` : 'Aucun avertissement - Test effectuÃ© correctement'}

DÃ‰TAIL DES RÃ‰PONSES
------------------------------
${student.detailsReponses ? student.detailsReponses.map((d, i) => 
  `Question ${d.question} (${d.difficulte}) : ${d.estCorrecte ? 'âœ“ CORRECT' : 'âœ— INCORRECT'} - ${d.points} pts`
).join('\n') : 'DÃ©tails non disponibles'}

==============================================
Rapport gÃ©nÃ©rÃ© le ${new Date().toLocaleString('fr-FR')}
==============================================
            `.trim();

            const blob = new Blob([report], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `rapport_${student.etudiant.replace(/\s/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();

            const Toast = Swal.mixin({
              toast: true,
              position: 'top-end',
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true
            });
            
            Toast.fire({
              icon: 'success',
              title: 'Rapport tÃ©lÃ©chargÃ© !'
            });
          };

          const getStatistics = () => {
            if (results.length === 0) return null;

            const notes = results.map(r => parseFloat(r.note));
            const moyenne = (notes.reduce((a, b) => a + b, 0) / notes.length).toFixed(2);
            const noteMax = Math.max(...notes).toFixed(2);
            const noteMin = Math.min(...notes).toFixed(2);
            const tauxReussite = ((results.filter(r => parseFloat(r.note) >= 10).length / results.length) * 100).toFixed(2);
            const totalTriche = results.reduce((sum, r) => sum + r.tentativesTriche, 0);

            return {
              total: results.length,
              moyenne,
              noteMax,
              noteMin,
              tauxReussite,
              totalTriche,
              totalIAGE: results.filter(r => r.classe === 'L2-IAGE').length,
              totalGL: results.filter(r => r.classe === 'L2-GL').length
            };
          };

          const filterResults = () => {
            let filtered = results;
            
            if (filter === 'passed') filtered = filtered.filter(r => parseFloat(r.note) >= 10);
            else if (filter === 'failed') filtered = filtered.filter(r => parseFloat(r.note) < 10);
            else if (filter === 'cheating') filtered = filtered.filter(r => r.tentativesTriche > 0);
            
            if (classFilter !== 'all') {
              filtered = filtered.filter(r => r.classe === classFilter);
            }
            
            return filtered;
          };

          if (!isAuthenticated) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-gray-900 to-indigo-900 flex items-center justify-center p-4">
                <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                  <div className="text-center mb-8">
                    <svg className="w-16 h-16 text-indigo-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    <h1 className="text-3xl font-bold text-gray-800 mb-2">Administration</h1>
                    <p className="text-gray-600">Tableau de bord - Quiz Python</p>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Identifiant</label>
                      <input
                        type="text"
                        value={loginInput}
                        onChange={(e) => setLoginInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Votre identifiant"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                      <input
                        type="password"
                        value={passwordInput}
                        onChange={(e) => setPasswordInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Votre mot de passe"
                      />
                    </div>

                    <button
                      onClick={handleLogin}
                      className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-lg"
                    >
                      Se connecter
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          const stats = getStatistics();
          const filteredResults = filterResults();

          return (
            <div className="min-h-screen bg-gray-50 p-6">
              <div className="max-w-7xl mx-auto">
                <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                  <div className="flex justify-between items-center">
                    <div>
                      <h1 className="text-3xl font-bold text-gray-800">Tableau de Bord Administrateur</h1>
                      <p className="text-gray-600">Quiz Python - Licence 2 {loading && <span className="text-green-600">ðŸ”„ Synchronisation en temps rÃ©el...</span>}</p>
                    </div>
                    <button
                      onClick={handleLogout}
                      className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                    >
                      DÃ©connexion
                    </button>
                  </div>
                </div>

                {stats && (
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div className="bg-white p-4 rounded-lg shadow">
                      <p className="text-sm text-gray-600">Total Ã©tudiants</p>
                      <p className="text-2xl font-bold text-indigo-600">{stats.total}</p>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow">
                      <p className="text-sm text-gray-600">L2-IAGE</p>
                      <p className="text-2xl font-bold text-blue-600">{stats.totalIAGE}</p>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow">
                      <p className="text-sm text-gray-600">L2-GL</p>
                      <p className="text-2xl font-bold text-teal-600">{stats.totalGL}</p>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow">
                      <p className="text-sm text-gray-600">Moyenne</p>
                      <p className="text-2xl font-bold text-purple-600">{stats.moyenne}/20</p>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow">
                      <p className="text-sm text-gray-600">Note max</p>
                      <p className="text-2xl font-bold text-green-600">{stats.noteMax}/20</p>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow">
                      <p className="text-sm text-gray-600">Note min</p>
                      <p className="text-2xl font-bold text-orange-600">{stats.noteMin}/20</p>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow">
                      <p className="text-sm text-gray-600">Taux rÃ©ussite</p>
                      <p className="text-2xl font-bold text-emerald-600">{stats.tauxReussite}%</p>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow">
                      <p className="text-sm text-gray-600">Total triches</p>
                      <p className="text-2xl font-bold text-red-600">{stats.totalTriche}</p>
                    </div>
                  </div>
                )}

                <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                  <div className="space-y-4">
                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-3">Filtrer par statut :</h3>
                      <div className="flex flex-wrap gap-2">
                        <button onClick={() => setFilter('all')} className={`px-4 py-2 rounded-lg font-medium transition-colors ${filter === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>
                          Tous ({results.length})
                        </button>
                        <button onClick={() => setFilter('passed')} className={`px-4 py-2 rounded-lg font-medium transition-colors ${filter === 'passed' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>
                          Admis ({results.filter(r => parseFloat(r.note) >= 10).length})
                        </button>
                        <button onClick={() => setFilter('failed')} className={`px-4 py-2 rounded-lg font-medium transition-colors ${filter === 'failed' ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>
                          Ã‰chec ({results.filter(r => parseFloat(r.note) < 10).length})
                        </button>
                        <button onClick={() => setFilter('cheating')} className={`px-4 py-2 rounded-lg font-medium transition-colors ${filter === 'cheating' ? 'bg-orange-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>
                          Avec triche ({results.filter(r => r.tentativesTriche > 0).length})
                        </button>
                      </div>
                    </div>

                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-3">Filtrer par classe :</h3>
                      <div className="flex flex-wrap gap-2">
                        <button onClick={() => setClassFilter('all')} className={`px-4 py-2 rounded-lg font-medium transition-colors ${classFilter === 'all' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>
                          Toutes les classes ({results.length})
                        </button>
                        <button onClick={() => setClassFilter('L2-IAGE')} className={`px-4 py-2 rounded-lg font-medium transition-colors ${classFilter === 'L2-IAGE' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>
                          L2-IAGE ({results.filter(r => r.classe === 'L2-IAGE').length})
                        </button>
                        <button onClick={() => setClassFilter('L2-GL')} className={`px-4 py-2 rounded-lg font-medium transition-colors ${classFilter === 'L2-GL' ? 'bg-teal-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>
                          L2-GL ({results.filter(r => r.classe === 'L2-GL').length})
                        </button>
                      </div>
                    </div>

                    <div className="flex justify-end gap-2 pt-2 border-t">
                      <button onClick={exportToCSV} className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Exporter CSV
                      </button>
                      <button onClick={clearAllResults} className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        Effacer tout
                      </button>
                    </div>
                  </div>
                </div>

                {filteredResults.length === 0 ? (
                  <div className="bg-white rounded-lg shadow-md p-12 text-center">
                    <p className="text-xl text-gray-600">Aucun rÃ©sultat disponible</p>
                    <p className="text-gray-500 mt-2">Les rÃ©sultats des Ã©tudiants apparaÃ®tront ici en temps rÃ©el</p>
                  </div>
                ) : (
                  <div className="bg-white rounded-lg shadow-md overflow-hidden">
                    <div className="overflow-x-auto">
                      <table className="w-full">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ã‰tudiant</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Classe</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Note</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">RÃ©ussite</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Triche</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {filteredResults.map((result, index) => (
                            <tr key={result.id || index} className="hover:bg-gray-50">
                              <td className="px-6 py-4 whitespace-nowrap">
                                <div className="text-sm font-medium text-gray-900">{result.etudiant}</div>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                <div className="text-sm text-gray-600">{result.classe}</div>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                <div className={`text-lg font-bold ${parseFloat(result.note) >= 10 ? 'text-green-600' : 'text-red-600'}`}>
                                  {result.note}/20
                                </div>
                                <div className="text-xs text-gray-500">{result.correct}/{result.total} correct</div>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                <span className={`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${parseFloat(result.note) >= 10 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                  {parseFloat(result.note) >= 10 ? 'Admis' : 'Ã‰chec'}
                                </span>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                {result.tentativesTriche > 0 ? (
                                  <div className="flex items-center text-red-600">
                                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    <span className="font-semibold">{result.tentativesTriche}</span>
                                  </div>
                                ) : (
                                  <span className="text-green-600">âœ“</span>
                                )}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{result.dateTest}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm">
                                <button onClick={() => setSelectedStudent(result)} className="flex items-center gap-1 text-indigo-600 hover:text-indigo-900 font-medium">
                                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                  </svg>
                                  DÃ©tails
                                </button>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {selectedStudent && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                      <div className="sticky top-0 bg-white border-b p-6">
                        <div className="flex justify-between items-start">
                          <div>
                            <h2 className="text-2xl font-bold text-gray-800">{selectedStudent.etudiant}</h2>
                            <p className="text-gray-600">{selectedStudent.classe}</p>
                          </div>
                          <button onClick={() => setSelectedStudent(null)} className="text-gray-400 hover:text-gray-600">
                            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                          </button>
                        </div>
                      </div>

                      <div className="p-6">
                        <div className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl p-6 mb-6">
                          <div className="text-center">
                            <p className="text-sm opacity-90 mb-2">Note Finale</p>
                            <p className="text-6xl font-bold mb-2">{selectedStudent.note}/20</p>
                            <p className="text-sm opacity-90">{selectedStudent.correct}/{selectedStudent.total} bonnes rÃ©ponses</p>
                            {selectedStudent.penalite > 0 && (
                              <p className="text-sm mt-2 bg-red-500 bg-opacity-30 py-2 px-4 rounded">
                                PÃ©nalitÃ© : -{selectedStudent.penalite} points
                              </p>
                            )}
                          </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-6">
                          <div className="bg-blue-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Points obtenus</p>
                            <p className="text-xl font-bold text-blue-600">{selectedStudent.points}/{selectedStudent.maxPoints}</p>
                          </div>
                          <div className="bg-green-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Pourcentage</p>
                            <p className="text-xl font-bold text-green-600">{selectedStudent.pourcentage}%</p>
                          </div>
                          <div className="bg-purple-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">DurÃ©e</p>
                            <p className="text-xl font-bold text-purple-600">{selectedStudent.duree}</p>
                          </div>
                          <div className="bg-red-50 p-4 rounded-lg">
                            <p className="text-sm text-gray-600">Tentatives triche</p>
                            <p className="text-xl font-bold text-red-600">{selectedStudent.tentativesTriche}</p>
                          </div>
                        </div>

                        {selectedStudent.tentativesTriche > 0 && (
                          <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                            <p className="font-semibold text-yellow-700 mb-2 flex items-center">
                              <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                              </svg>
                              Avertissements enregistrÃ©s :
                            </p>
                            <ul className="text-sm text-yellow-600 space-y-1">
                              {selectedStudent.avertissements.map((warning, idx) => (
                                <li key={idx}>â€¢ {warning}</li>
                              ))}
                            </ul>
                          </div>
                        )}

                        {selectedStudent.detailsReponses && (
                          <div className="mb-6">
                            <h3 className="font-bold text-gray-800 mb-4">DÃ©tail par question :</h3>
                            <div className="space-y-2 max-h-96 overflow-y-auto">
                              {selectedStudent.detailsReponses.map((detail, idx) => (
                                <div key={idx} className={`flex items-center justify-between p-3 rounded-lg ${detail.estCorrecte ? 'bg-green-50' : 'bg-red-50'}`}>
                                  <div className="flex items-center gap-3">
                                    <svg className={`w-5 h-5 ${detail.estCorrecte ? 'text-green-600' : 'text-red-600'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      {detail.estCorrecte ? (
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                      ) : (
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                      )}
                                    </svg>
                                    <span className="font-medium text-gray-700">Question {detail.question}</span>
                                    <span className="text-sm text-gray-600">({detail.difficulte})</span>
                                  </div>
                                  <span className="font-bold text-gray-700">{detail.points} pts</span>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}

                        <div className="flex gap-3">
                          <button onClick={() => exportDetailedReport(selectedStudent)} className="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            TÃ©lÃ©charger le rapport
                          </button>
                          <button onClick={() => setSelectedStudent(null)} className="px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                            Fermer
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminDashboard />);
    </script>
</body>
</html>
