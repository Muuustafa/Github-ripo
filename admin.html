<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Quiz Python</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
      @keyframes pulse-ring {
        0% { transform: scale(0.95); opacity: 1; }
        50% { transform: scale(1.05); opacity: 0.7; }
        100% { transform: scale(0.95); opacity: 1; }
      }
      .animate-pulse-ring {
        animation: pulse-ring 2s ease-in-out infinite;
      }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
          apiKey: "AIzaSyCYjXM6YrfB862p48g6_mYX66C_La0ZsI0",
          authDomain: "quiz-python-isikm.firebaseapp.com",
          projectId: "quiz-python-isikm",
          storageBucket: "quiz-python-isikm.firebasestorage.app",
          messagingSenderId: "559369640769",
          appId: "1:559369640769:web:1ad8cb3d771f134f4d5fc0"
        };

        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        const ADMIN_CREDENTIALS = {
          login: 'mustafa',
          password: '14051994'
        };

        const QUIZ_QUESTIONS = [
          { id: 1, code: "x = 5\\nprint(x)", question: "Quelle est la sortie de ce code ?", options: ["x", "5", "Erreur", "None"], correct: 1, points: 1, difficulty: "Facile" },
          { id: 2, code: "y = 10\\ny = y + 5\\nprint(y)", question: "Quelle est la sortie de ce code ?", options: ["10", "5", "15", "Erreur"], correct: 2, points: 1, difficulty: "Facile" },
          { id: 3, code: "print(3 + 2 * 2)", question: "Quelle est la sortie de ce code ?", options: ["10", "7", "8", "6"], correct: 1, points: 1, difficulty: "Facile" },
          { id: 4, code: "x = \\"Hello\\"\\nprint(type(x))", question: "Quelle est la sortie de ce code ?", options: ["<class 'int'>", "<class 'str'>", "Hello", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
          { id: 5, code: "liste = [1, 2, 3]\\nprint(liste[0])", question: "Quelle est la sortie de ce code ?", options: ["0", "2", "[1]", "1"], correct: 3, points: 1, difficulty: "Facile" },
          { id: 6, code: "x = 4\\nif x > 2:\\n    print(\\"Oui\\")", question: "Quelle est la sortie de ce code ?", options: ["Non", "4", "Oui", "Rien"], correct: 2, points: 1, difficulty: "Facile" },
          { id: 7, code: "print(10 - 3)", question: "Quelle est la sortie de ce code ?", options: ["13", "3", "10", "7"], correct: 3, points: 1, difficulty: "Facile" },
          { id: 8, code: "x = 2 * 3\\nprint(x)", question: "Quelle est la sortie de ce code ?", options: ["5", "23", "6", "Erreur"], correct: 2, points: 1, difficulty: "Facile" },
          { id: 9, code: "x = True\\nprint(x)", question: "Quelle est la sortie de ce code ?", options: ["1", "True", "true", "Erreur"], correct: 1, points: 1, difficulty: "Facile" },
          { id: 10, code: "liste = [10, 20, 30]\\nprint(len(liste))", question: "Quelle est la sortie de ce code ?", options: ["60", "10", "3", "Erreur"], correct: 2, points: 1, difficulty: "Facile" },
          { id: 11, code: "x = 7\\nprint(x % 2)", question: "Quelle est la sortie de ce code ?", options: ["0", "1", "3.5", "7"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
          { id: 12, code: "x = \\"A\\"\\ny = \\"B\\"\\nprint(x + y)", question: "Quelle est la sortie de ce code ?", options: ["A B", "AB", "Erreur", "BA"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
          { id: 13, code: "for i in range(3):\\n    print(i, end=\\"\\")", question: "Quelle est la sortie de ce code ?", options: ["123", "012", "0 1 2", "321"], correct: 1, points: 1.25, difficulty: "Assez Facile" },
          { id: 14, code: "x = 8\\nprint(x // 3)", question: "Quelle est la sortie de ce code ?", options: ["2.67", "3", "2", "8"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
          { id: 15, code: "x = 15\\nif x > 20:\\n    print(\\"Grand\\")\\nelse:\\n    print(\\"Petit\\")", question: "Quelle est la sortie de ce code ?", options: ["Grand", "15", "Petit", "Rien"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
          { id: 16, code: "liste = [5, 10, 15]\\nprint(liste[2])", question: "Quelle est la sortie de ce code ?", options: ["10", "2", "5", "15"], correct: 3, points: 1.25, difficulty: "Assez Facile" },
          { id: 17, code: "x = 5\\ny = 10\\nprint(x < y)", question: "Quelle est la sortie de ce code ?", options: ["False", "5", "True", "10"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
          { id: 18, code: "i = 0\\nwhile i < 2:\\n    i += 1\\nprint(i)", question: "Quelle est la sortie de ce code ?", options: ["0", "1", "2", "3"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
          { id: 19, code: "x = \\"Python\\"\\nprint(len(x))", question: "Quelle est la sortie de ce code ?", options: ["5", "7", "6", "Erreur"], correct: 2, points: 1.25, difficulty: "Assez Facile" },
          { id: 20, code: "x = 10\\nx += 5\\nprint(x)", question: "Quelle est la sortie de ce code ?", options: ["10", "5", "105", "15"], correct: 3, points: 1.25, difficulty: "Assez Facile" },
          { id: 21, code: "liste = [1, 2, 3, 4, 5]\\nprint(liste[1:4])", question: "Quelle est la sortie de ce code ?", options: ["[1, 2, 3]", "[2, 3, 4]", "[1, 2, 3, 4]", "[2, 3]"], correct: 1, points: 1.5, difficulty: "Moyen" },
          { id: 22, code: "x = \\"Python\\"\\nprint(x[0] + x[-1])", question: "Quelle est la sortie de ce code ?", options: ["Py", "Pn", "Python", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
          { id: 23, code: "x = 5\\ny = 2\\nprint(x ** y)", question: "Quelle est la sortie de ce code ?", options: ["10", "7", "52", "25"], correct: 3, points: 1.5, difficulty: "Moyen" },
          { id: 24, code: "for i in range(5):\\n    if i == 2:\\n        continue\\n    print(i, end=\\" \\")", question: "Quelle est la sortie de ce code ?", options: ["0 1 2 3 4", "0 1 3 4", "1 3 4", "0 1 2"], correct: 1, points: 1.5, difficulty: "Moyen" },
          { id: 25, code: "liste = [10, 20, 30]\\nliste.append(40)\\nprint(len(liste))", question: "Quelle est la sortie de ce code ?", options: ["3", "40", "4", "100"], correct: 2, points: 1.5, difficulty: "Moyen" },
          { id: 26, code: "x = 10\\nif x > 5 and x < 15:\\n    print(\\"OK\\")\\nelse:\\n    print(\\"NON\\")", question: "Quelle est la sortie de ce code ?", options: ["NON", "True", "OK", "10"], correct: 2, points: 1.5, difficulty: "Moyen" },
          { id: 27, code: "x = \\"bonjour\\"\\nprint(x.upper())", question: "Quelle est la sortie de ce code ?", options: ["bonjour", "Bonjour", "BONJOUR", "Erreur"], correct: 2, points: 1.5, difficulty: "Moyen" },
          { id: 28, code: "x = [1, 2, 3]\\nx[1] = 10\\nprint(x)", question: "Quelle est la sortie de ce code ?", options: ["[1, 10, 3]", "[10, 2, 3]", "[1, 2, 10]", "Erreur"], correct: 0, points: 1.5, difficulty: "Moyen" },
          { id: 29, code: "def somme(a, b):\\n    return a + b\\nprint(somme(3, 4))", question: "Quelle est la sortie de ce code ?", options: ["34", "7", "None", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
          { id: 30, code: "x = 7\\nresultat = \\"Pair\\" if x % 2 == 0 else \\"Impair\\"\\nprint(resultat)", question: "Quelle est la sortie de ce code ?", options: ["Pair", "Impair", "7", "Erreur"], correct: 1, points: 1.5, difficulty: "Moyen" },
          { id: 31, code: "liste = [1, 2, 3]\\nliste.extend([4, 5])\\nprint(len(liste))", question: "Quelle est la sortie de ce code ?", options: ["3", "2", "5", "Erreur"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
          { id: 32, code: "x = \\"123\\"\\nprint(x * 2)", question: "Quelle est la sortie de ce code ?", options: ["246", "123123", "Erreur", "6"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
          { id: 33, code: "x = 5\\nfor i in range(3):\\n    x += i\\nprint(x)", question: "Quelle est la sortie de ce code ?", options: ["5", "6", "8", "11"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
          { id: 34, code: "liste = [1, 2, 3, 2, 1]\\nprint(liste.count(2))", question: "Quelle est la sortie de ce code ?", options: ["1", "2", "3", "5"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
          { id: 35, code: "x = 10\\nwhile x > 0:\\n    x -= 3\\n    if x == 4:\\n        break\\nprint(x)", question: "Quelle est la sortie de ce code ?", options: ["7", "1", "4", "0"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
          { id: 36, code: "def test(n):\\n    if n > 0:\\n        return n\\n    return 0\\nprint(test(-5))", question: "Quelle est la sortie de ce code ?", options: ["-5", "5", "None", "0"], correct: 3, points: 1.75, difficulty: "Assez Difficile" },
          { id: 37, code: "x = [1, 2]\\ny = [3, 4]\\nz = x + y\\nprint(len(z))", question: "Quelle est la sortie de ce code ?", options: ["2", "3", "4", "Erreur"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
          { id: 38, code: "x = \\"abc\\"\\ny = x.replace(\\"b\\", \\"X\\")\\nprint(y)", question: "Quelle est la sortie de ce code ?", options: ["abc", "aXc", "Xbc", "abX"], correct: 1, points: 1.75, difficulty: "Assez Difficile" },
          { id: 39, code: "liste = [5, 2, 8, 1]\\nprint(max(liste))", question: "Quelle est la sortie de ce code ?", options: ["5", "1", "8", "2"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
          { id: 40, code: "x = 3\\ny = 5\\nx, y = y, x\\nprint(x)", question: "Quelle est la sortie de ce code ?", options: ["3", "8", "5", "Erreur"], correct: 2, points: 1.75, difficulty: "Assez Difficile" },
          { id: 41, code: "x = \\"Python\\"\\nprint(x[::-1])", question: "Quelle est la sortie de ce code ?", options: ["Python", "nohtyP", "Pyth", "Erreur"], correct: 1, points: 2, difficulty: "Tr√®s Difficile" },
          { id: 42, code: "def mystere(n):\\n    if n <= 1:\\n        return 1\\n    return n * mystere(n - 1)\\nprint(mystere(4))", question: "Quelle est la sortie de ce code ?", options: ["4", "10", "24", "Erreur"], correct: 2, points: 2, difficulty: "Tr√®s Difficile" },
          { id: 43, code: "liste = [1, 2, 3, 4, 5]\\nresultat = [x * 2 for x in liste if x % 2 == 0]\\nprint(resultat)", question: "Quelle est la sortie de ce code ?", options: ["[2, 4, 6, 8, 10]", "[4, 8]", "[2, 4]", "[1, 2, 3, 4, 5]"], correct: 1, points: 2, difficulty: "Tr√®s Difficile" },
          { id: 44, code: "x = [1, 2, 3]\\ny = x\\ny.append(4)\\nprint(len(x))", question: "Quelle est la sortie de ce code ? (PI√àGE!)", options: ["3", "4", "Erreur", "7"], correct: 1, points: 2, difficulty: "Tr√®s Difficile" },
          { id: 45, code: "def func(a, b=5, c=10):\\n    return a + b + c\\nprint(func(1, c=3))", question: "Quelle est la sortie de ce code ?", options: ["14", "19", "9", "Erreur"], correct: 2, points: 2, difficulty: "Tr√®s Difficile" },
          { id: 46, code: "liste = [1, [2, 3], 4]\\nprint(liste[1][1])", question: "Quelle est la sortie de ce code ?", options: ["2", "[2, 3]", "3", "Erreur"], correct: 2, points: 2, difficulty: "Tr√®s Difficile" },
          { id: 47, code: "x = 10\\nwhile x > 0:\\n    if x == 5:\\n        break\\n    x -= 2\\nprint(x)", question: "Quelle est la sortie de ce code ? (Attention au pi√®ge!)", options: ["5", "4", "6", "0"], correct: 2, points: 2, difficulty: "Tr√®s Difficile" },
          { id: 48, code: "def modifier(liste):\\n    liste.append(100)\\n\\nma_liste = [1, 2]\\nmodifier(ma_liste)\\nprint(len(ma_liste))", question: "Quelle est la sortie de ce code ?", options: ["2", "100", "3", "Erreur"], correct: 2, points: 2, difficulty: "Tr√®s Difficile" },
          { id: 49, code: "x = \\"123\\"\\ny = int(x) + 7\\nprint(y)", question: "Quelle est la sortie de ce code ?", options: ["1237", "130", "123", "Erreur"], correct: 1, points: 2, difficulty: "Tr√®s Difficile" },
          { id: 50, code: "liste = [3, 1, 4, 1, 5]\\nliste.sort()\\nprint(liste[2])", question: "Quelle est la sortie de ce code ? (R√©fl√©chissez!)", options: ["4", "1", "3", "5"], correct: 2, points: 2, difficulty: "Tr√®s Difficile" }
        ];

        function AdminDashboard() {
          const [isAuthenticated, setIsAuthenticated] = useState(() => {
            return localStorage.getItem('adminAuthenticated') === 'true';
          });
          const [loginInput, setLoginInput] = useState('');
          const [passwordInput, setPasswordInput] = useState('');
          const [results, setResults] = useState([]);
          const [activeSessions, setActiveSessions] = useState([]);
          const [selectedStudent, setSelectedStudent] = useState(null);
          const [filter, setFilter] = useState('all');
          const [classFilter, setClassFilter] = useState('all');
          const [loading, setLoading] = useState(false);
          const [showSessions, setShowSessions] = useState(false);
          const [detailView, setDetailView] = useState('summary');

          useEffect(() => {
            if (isAuthenticated) {
              setLoading(true);
              const unsubscribe = db.collection('results')
                .orderBy('timestamp', 'desc')
                .onSnapshot((snapshot) => {
                  const resultsData = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                  }));
                  setResults(resultsData);
                  setLoading(false);
                }, (error) => {
                  console.error('Erreur Firebase:', error);
                  setLoading(false);
                });

              return () => unsubscribe();
            }
          }, [isAuthenticated]);

          useEffect(() => {
            if (isAuthenticated) {
              const unsubscribe = db.collection('quiz_sessions')
                .where('status', 'in', ['started'])
                .onSnapshot((snapshot) => {
                  snapshot.docChanges().forEach((change) => {
                    const session = { id: change.doc.id, ...change.doc.data() };
                    
                    if (change.type === 'added') {
                      const Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 5000,
                        timerProgressBar: true
                      });
                      
                      Toast.fire({
                        icon: 'info',
                        title: 'üéì Quiz commenc√©',
                        html: `<strong>${session.etudiant}</strong><br/>${session.classe}`
                      });
                    }
                    
                    if (change.type === 'modified') {
                      if (session.tabSwitches > 0 && session.lastWarning) {
                        const Toast = Swal.mixin({
                          toast: true,
                          position: 'top-end',
                          showConfirmButton: false,
                          timer: 8000,
                          timerProgressBar: true
                        });
                        
                        Toast.fire({
                          icon: 'warning',
                          title: '‚ö†Ô∏è TRICHE D√âTECT√âE',
                          html: `
                            <div class="text-left">
                              <p><strong>${session.etudiant}</strong></p>
                              <p class="text-sm">${session.classe}</p>
                              <p class="text-red-600 font-bold mt-2">${session.tabSwitches} changement(s) d'onglet</p>
                              <p class="text-xs text-gray-600 mt-1">${session.lastWarning}</p>
                            </div>
                          `
                        });
                      }
                    }
                  });

                  const currentSessions = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                  }));
                  setActiveSessions(currentSessions);
                }, (error) => {
                  console.error('Erreur sessions:', error);
                });

              return () => unsubscribe();
            }
          }, [isAuthenticated]);

          const handleLogin = () => {
            if (loginInput === ADMIN_CREDENTIALS.login && passwordInput === ADMIN_CREDENTIALS.password) {
              setIsAuthenticated(true);
              localStorage.setItem('adminAuthenticated', 'true');
              setLoginInput('');
              setPasswordInput('');
              
              const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
              });
              
              Toast.fire({
                icon: 'success',
                title: 'Connexion r√©ussie !',
                text: 'Surveillance en temps r√©el activ√©e'
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: '√âchec de connexion',
                text: 'Identifiant ou mot de passe incorrect.',
                confirmButtonColor: '#DC2626'
              });
            }
          };

          const handleLogout = async () => {
            const result = await Swal.fire({
              icon: 'question',
              title: 'D√©connexion',
              text: 'Voulez-vous vraiment vous d√©connecter ?',
              showCancelButton: true,
              confirmButtonColor: '#DC2626',
              cancelButtonColor: '#6B7280',
              confirmButtonText: 'Oui, d√©connecter',
              cancelButtonText: 'Annuler'
            });

            if (result.isConfirmed) {
              setIsAuthenticated(false);
              localStorage.removeItem('adminAuthenticated');
              setSelectedStudent(null);
              
              const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true
              });
              
              Toast.fire({
                icon: 'info',
                title: 'D√©connect√© avec succ√®s'
              });
            }
          };

          const clearAllResults = async () => {
            const result = await Swal.fire({
              icon: 'warning',
              title: '√ätes-vous s√ªr ?',
              html: '<p>Supprimer <strong>TOUS</strong> les r√©sultats ?</p><p class="text-red-600 font-semibold mt-2">Action IRR√âVERSIBLE !</p>',
              showCancelButton: true,
              confirmButtonColor: '#DC2626',
              cancelButtonColor: '#6B7280',
              confirmButtonText: 'Oui, tout supprimer',
              cancelButtonText: 'Annuler'
            });

            if (result.isConfirmed) {
              try {
                const batch = db.batch();
                const snapshot = await db.collection('results').get();
                snapshot.docs.forEach(doc => {
                  batch.delete(doc.ref);
                });
                await batch.commit();
                
                setSelectedStudent(null);
                
                Swal.fire({
                  icon: 'success',
                  title: 'Supprim√© !',
                  text: 'Tous les r√©sultats ont √©t√© supprim√©s.',
                  confirmButtonColor: '#10B981'
                });
              } catch (error) {
                Swal.fire({
                  icon: 'error',
                  title: 'Erreur',
                  text: 'Impossible de supprimer les r√©sultats.',
                  confirmButtonColor: '#DC2626'
                });
              }
            }
          };

          const exportToCSV = () => {
            if (results.length === 0) {
              Swal.fire({
                icon: 'info',
                title: 'Aucun r√©sultat',
                text: 'Il n\'y a aucun r√©sultat √† exporter.',
                confirmButtonColor: '#4F46E5'
              });
              return;
            }

            const csv = [
              ['Nom Complet', 'Classe', 'Note/20', 'Pourcentage', 'Bonnes R√©ponses', 'Total Questions', 'Points Obtenus', 'Points Max', 'Tentatives Triche', 'P√©nalit√©', 'Date', 'Dur√©e'],
              ...results.map(r => [
                r.etudiant,
                r.classe,
                r.note,
                r.pourcentage + '%',
                r.correct,
                r.total,
                r.points,
                r.maxPoints,
                r.tentativesTriche,
                r.penalite,
                r.dateTest,
                r.duree
              ])
            ].map(row => row.join(',')).join('\\n');

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `resultats_quiz_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            const Toast = Swal.mixin({
              toast: true,
              position: 'top-end',
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true
            });
            
            Toast.fire({
              icon: 'success',
              title: `${results.length} r√©sultat(s) export√©(s) !`
            });
          };

          const exportDetailedReport = (student) => {
            const report = `
==============================================
RAPPORT D√âTAILL√â - QUIZ PYTHON
==============================================

INFORMATIONS √âTUDIANT
------------------------------
Nom complet : ${student.etudiant}
Classe : ${student.classe}
Date du test : ${student.dateTest}
Dur√©e du test : ${student.duree}

R√âSULTATS
------------------------------
Note finale : ${student.note}/20
Pourcentage de r√©ussite : ${student.pourcentage}%
R√©ponses correctes : ${student.correct}/${student.total}
Points obtenus : ${student.points}/${student.maxPoints}

SYST√àME ANTI-TRICHE
------------------------------
Tentatives d√©tect√©es : ${student.tentativesTriche}
P√©nalit√© appliqu√©e : -${student.penalite} points

${student.tentativesTriche > 0 ? `AVERTISSEMENTS ENREGISTR√âS :
${student.avertissements.map((w, i) => `${i + 1}. ${w}`).join('\\n')}` : 'Aucun avertissement - Test effectu√© correctement'}

D√âTAIL DES R√âPONSES
------------------------------
${student.detailsReponses ? student.detailsReponses.map((d) => 
  `Question ${d.question} (${d.difficulte}) : ${d.estCorrecte ? '‚úì CORRECT' : '‚úó INCORRECT'} - ${d.points} pts`
).join('\\n') : 'D√©tails non disponibles'}

==============================================
Rapport g√©n√©r√© le ${new Date().toLocaleString('fr-FR')}
==============================================
            `.trim();

            const blob = new Blob([report], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `rapport_${student.etudiant.replace(/\\s/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();

            const Toast = Swal.mixin({
              toast: true,
              position: 'top-end',
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true
            });
            
            Toast.fire({
              icon: 'success',
              title: 'Rapport t√©l√©charg√© !'
            });
          };

          const getStatistics = () => {
            if (results.length === 0) return null;

            const notes = results.map(r => parseFloat(r.note));
            const moyenne = (notes.reduce((a, b) => a + b, 0) / notes.length).toFixed(2);
            const noteMax = Math.max(...notes).toFixed(2);
            const noteMin = Math.min(...notes).toFixed(2);
            const tauxReussite = ((results.filter(r => parseFloat(r.note) >= 10).length / results.length) * 100).toFixed(2);
            const totalTriche = results.reduce((sum, r) => sum + r.tentativesTriche, 0);

            return {
              total: results.length,
              moyenne,
              noteMax,
              noteMin,
              tauxReussite,
              totalTriche,
              totalIAGE: results.filter(r => r.classe === 'L2-IAGE').length,
              totalGL: results.filter(r => r.classe === 'L2-GL').length
            };
          };

          const filterResults = () => {
            let filtered = results;
            
            if (filter === 'passed') filtered = filtered.filter(r => parseFloat(r.note) >= 10);
            else if (filter === 'failed') filtered = filtered.filter(r => parseFloat(r.note) < 10);
            else if (filter === 'cheating') filtered = filtered.filter(r => r.tentativesTriche > 0);
            
            if (classFilter !== 'all') {
              filtered = filtered.filter(r => r.classe === classFilter);
            }
            
            return filtered;
          };

          const getQuestionDetails = (questionId) => {
            return QUIZ_QUESTIONS.find(q => q.id === questionId);
          };

          const getDetailedAnswers = (student) => {
            if (!student.detailsReponses) return { correct: [], incorrect: [], unanswered: [] };

            const correct = [];
            const incorrect = [];
            const unanswered = [];

            student.detailsReponses.forEach(detail => {
              const question = getQuestionDetails(detail.question);
              if (question) {
                const answerData = {
                  ...detail,
                  questionData: question
                };
                
                if (detail.reponse === -1) {
                  unanswered.push(answerData);
                } else if (detail.estCorrecte) {
                  correct.push(answerData);
                } else {
                  incorrect.push(answerData);
                }
              }
            });

            return { correct, incorrect, unanswered };
          };

          if (!isAuthenticated) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-gray-900 to-indigo-900 flex items-center justify-center p-4">
                <div className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full">
                  <div className="text-center mb-8">
                    <svg className="w-12 h-12 sm:w-16 sm:h-16 text-indigo-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    <h1 className="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">Administration</h1>
                    <p className="text-sm sm:text-base text-gray-600">Tableau de bord - Quiz Python</p>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Identifiant</label>
                      <input
                        type="text"
                        value={loginInput}
                        onChange={(e) => setLoginInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Votre identifiant"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                      <input
                        type="password"
                        value={passwordInput}
                        onChange={(e) => setPasswordInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Votre mot de passe"
                      />
                    </div>

                    <button
                      onClick={handleLogin}
                      className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-lg"
                    >
                      Se connecter
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          const stats = getStatistics();
          const filteredResults = filterResults();

          return (
            <div className="min-h-screen bg-gray-50 p-3 sm:p-6">
              <div className="max-w-7xl mx-auto">
                <div className="bg-white rounded-lg shadow-md p-4 sm:p-6 mb-4 sm:mb-6">
                  <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <div>
                      <h1 className="text-2xl sm:text-3xl font-bold text-gray-800">Tableau de Bord Admin</h1>
                      <p className="text-sm sm:text-base text-gray-600 flex items-center gap-2">
                        Quiz Python - L2 
                        {loading && <span className="text-green-600 text-xs">üîÑ Synchro...</span>}
                      </p>
                    </div>
                    <div className="flex gap-2 w-full sm:w-auto">
                      <button
                        onClick={() => setShowSessions(!showSessions)}
                        className="flex-1 sm:flex-none relative px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base"
                      >
                        {activeSessions.length > 0 && (
                          <span className="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center animate-pulse-ring">
                            {activeSessions.length}
                          </span>
                        )}
                        üéì En cours
                      </button>
                      <button
                        onClick={handleLogout}
                        className="flex-1 sm:flex-none px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm sm:text-base"
                      >
                        D√©connexion
                      </button>
                    </div>
                  </div>
                </div>

                {showSessions && activeSessions.length > 0 && (
                  <div className="bg-white rounded-lg shadow-md p-4 sm:p-6 mb-4 sm:mb-6">
                    <h2 className="text-lg sm:text-xl font-bold text-gray-800 mb-4 flex items-center">
                      <span className="w-3 h-3 bg-green-500 rounded-full animate-pulse mr-2"></span>
                      Quiz en cours ({activeSessions.length})
                    </h2>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                      {activeSessions.map(session => (
                        <div key={session.id} className="border-2 border-green-500 rounded-lg p-3 sm:p-4 bg-green-50">
                          <p className="font-bold text-gray-800 text-sm sm:text-base">{session.etudiant}</p>
                          <p className="text-xs sm:text-sm text-gray-600">{session.classe}</p>
                          <div className="mt-2 flex items-center justify-between text-xs">
                            <span className="text-gray-600">
                              Question {session.currentQuestion || 0}/50
                            </span>
                            {session.tabSwitches > 0 && (
                              <span className="text-red-600 font-bold">
                                ‚ö†Ô∏è {session.tabSwitches}
                              </span>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {stats && (
                  <div className="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6">
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Total</p>
                      <p className="text-xl sm:text-2xl font-bold text-indigo-600">{stats.total}</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">L2-IAGE</p>
                      <p className="text-xl sm:text-2xl font-bold text-blue-600">{stats.totalIAGE}</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">L2-GL</p>
                      <p className="text-xl sm:text-2xl font-bold text-teal-600">{stats.totalGL}</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Moyenne</p>
                      <p className="text-xl sm:text-2xl font-bold text-purple-600">{stats.moyenne}/20</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Note max</p>
                      <p className="text-xl sm:text-2xl font-bold text-green-600">{stats.noteMax}/20</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Note min</p>
                      <p className="text-xl sm:text-2xl font-bold text-orange-600">{stats.noteMin}/20</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">R√©ussite</p>
                      <p className="text-xl sm:text-2xl font-bold text-emerald-600">{stats.tauxReussite}%</p>
                    </div>
                    <div className="bg-white p-3 sm:p-4 rounded-lg shadow">
                      <p className="text-xs sm:text-sm text-gray-600">Triches</p>
                      <p className="text-xl sm:text-2xl font-bold text-red-600">{stats.totalTriche}</p>
                    </div>
                  </div>
                )}

                <div className="bg-white rounded-lg shadow-md p-4 sm:p-6 mb-4 sm:mb-6">
                  <div className="space-y-4">
                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-3">Filtrer par statut :</h3>
                      <div className="flex flex-wrap gap-2">
                        <button onClick={() => setFilter('all')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${filter === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          Tous ({results.length})
                        </button>
                        <button onClick={() => setFilter('passed')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${filter === 'passed' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          Admis ({results.filter(r => parseFloat(r.note) >= 10).length})
                        </button>
                        <button onClick={() => setFilter('failed')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${filter === 'failed' ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          √âchec ({results.filter(r => parseFloat(r.note) < 10).length})
                        </button>
                        <button onClick={() => setFilter('cheating')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${filter === 'cheating' ? 'bg-orange-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          Triche ({results.filter(r => r.tentativesTriche > 0).length})
                        </button>
                      </div>
                    </div>

                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-3">Filtrer par classe :</h3>
                      <div className="flex flex-wrap gap-2">
                        <button onClick={() => setClassFilter('all')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${classFilter === 'all' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          Toutes ({results.length})
                        </button>
                        <button onClick={() => setClassFilter('L2-IAGE')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${classFilter === 'L2-IAGE' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          L2-IAGE ({results.filter(r => r.classe === 'L2-IAGE').length})
                        </button>
                        <button onClick={() => setClassFilter('L2-GL')} className={`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-xs sm:text-sm ${classFilter === 'L2-GL' ? 'bg-teal-600 text-white' : 'bg-gray-200 text-gray-700'}`}>
                          L2-GL ({results.filter(r => r.classe === 'L2-GL').length})
                        </button>
                      </div>
                    </div>

                    <div className="flex flex-col sm:flex-row justify-end gap-2 pt-2 border-t">
                      <button onClick={exportToCSV} className="flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">
                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Exporter CSV
                      </button>
                      <button onClick={clearAllResults} className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm">
                        Effacer tout
                      </button>
                    </div>
                  </div>
                </div>

                {filteredResults.length === 0 ? (
                  <div className="bg-white rounded-lg shadow-md p-8 sm:p-12 text-center">
                    <p className="text-lg sm:text-xl text-gray-600">Aucun r√©sultat</p>
                    <p className="text-sm sm:text-base text-gray-500 mt-2">Les r√©sultats appara√Ætront ici en temps r√©el</p>
                  </div>
                ) : (
                  <div className="bg-white rounded-lg shadow-md overflow-hidden">
                    <div className="block sm:hidden">
                      {filteredResults.map((result, index) => (
                        <div key={result.id || index} className="border-b p-4">
                          <div className="flex justify-between items-start mb-2">
                            <div>
                              <p className="font-bold text-gray-800">{result.etudiant}</p>
                              <p className="text-sm text-gray-600">{result.classe}</p>
                            </div>
                            <p className={`text-2xl font-bold ${parseFloat(result.note) >= 10 ? 'text-green-600' : 'text-red-600'}`}>
                              {result.note}/20
                            </p>
                          </div>
                          <div className="flex justify-between items-center">
                            <span className={`px-3 py-1 text-xs rounded-full ${parseFloat(result.note) >= 10 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                              {parseFloat(result.note) >= 10 ? 'Admis' : '√âchec'}
                            </span>
                            <button onClick={() => { setSelectedStudent(result); setDetailView('summary'); }} className="text-indigo-600 text-sm font-medium">
                              D√©tails ‚Üí
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>

                    <div className="hidden sm:block overflow-x-auto">
                      <table className="w-full">
                        <thead className="bg-gray-50">
                          <tr>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">√âtudiant</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Classe</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Note</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">R√©ussite</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Triche</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                          </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                          {filteredResults.map((result, index) => (
                            <tr key={result.id || index} className="hover:bg-gray-50">
                              <td className="px-6 py-4 whitespace-nowrap">
                                <div className="text-sm font-medium text-gray-900">{result.etudiant}</div>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                <div className="text-sm text-gray-600">{result.classe}</div>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                <div className={`text-lg font-bold ${parseFloat(result.note) >= 10 ? 'text-green-600' : 'text-red-600'}`}>
                                  {result.note}/20
                                </div>
                                <div className="text-xs text-gray-500">{result.correct}/{result.total} correct</div>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                <span className={`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${parseFloat(result.note) >= 10 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                  {parseFloat(result.note) >= 10 ? 'Admis' : '√âchec'}
                                </span>
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap">
                                {result.tentativesTriche > 0 ? (
                                  <div className="flex items-center text-red-600">
                                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    <span className="font-semibold">{result.tentativesTriche}</span>
                                  </div>
                                ) : (
                                  <span className="text-green-600">‚úì</span>
                                )}
                              </td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{result.dateTest}</td>
                              <td className="px-6 py-4 whitespace-nowrap text-sm">
                                <button onClick={() => { setSelectedStudent(result); setDetailView('summary'); }} className="flex items-center gap-1 text-indigo-600 hover:text-indigo-900 font-medium">
                                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                  </svg>
                                  D√©tails
                                </button>
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </div>
                )}

                {selectedStudent && (() => {
                  const detailedAnswers = getDetailedAnswers(selectedStudent);
                  
                  return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                      <div className="bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                        <div className="sticky top-0 bg-white border-b p-4 sm:p-6 z-10">
                          <div className="flex justify-between items-start">
                            <div>
                              <h2 className="text-xl sm:text-2xl font-bold text-gray-800">{selectedStudent.etudiant}</h2>
                              <p className="text-sm sm:text-base text-gray-600">{selectedStudent.classe}</p>
                            </div>
                            <button onClick={() => setSelectedStudent(null)} className="text-gray-400 hover:text-gray-600">
                              <svg className="w-6 h-6 sm:w-8 sm:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                              </svg>
                            </button>
                          </div>
                        </div>

                        <div className="p-4 sm:p-6">
                          <div className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl p-6 mb-6">
                            <div className="text-center">
                              <p className="text-sm opacity-90 mb-2">Note Finale</p>
                              <p className="text-5xl sm:text-6xl font-bold mb-2">{selectedStudent.note}/20</p>
                              <p className="text-sm opacity-90">{selectedStudent.correct}/{selectedStudent.total} bonnes r√©ponses</p>
                              {selectedStudent.penalite > 0 && (
                                <p className="text-sm mt-2 bg-red-500 bg-opacity-30 py-2 px-4 rounded">
                                  P√©nalit√© : -{selectedStudent.penalite} points
                                </p>
                              )}
                            </div>
                          </div>

                          <div className="grid grid-cols-2 gap-4 mb-6">
                            <div className="bg-blue-50 p-4 rounded-lg">
                              <p className="text-xs sm:text-sm text-gray-600">Points obtenus</p>
                              <p className="text-lg sm:text-xl font-bold text-blue-600">{selectedStudent.points}/{selectedStudent.maxPoints}</p>
                            </div>
                            <div className="bg-green-50 p-4 rounded-lg">
                              <p className="text-xs sm:text-sm text-gray-600">Pourcentage</p>
                              <p className="text-lg sm:text-xl font-bold text-green-600">{selectedStudent.pourcentage}%</p>
                            </div>
                            <div className="bg-purple-50 p-4 rounded-lg">
                              <p className="text-xs sm:text-sm text-gray-600">Dur√©e</p>
                              <p className="text-lg sm:text-xl font-bold text-purple-600">{selectedStudent.duree}</p>
                            </div>
                            <div className="bg-red-50 p-4 rounded-lg">
                              <p className="text-xs sm:text-sm text-gray-600">Tentatives triche</p>
                              <p className="text-lg sm:text-xl font-bold text-red-600">{selectedStudent.tentativesTriche}</p>
                            </div>
                          </div>

                          {selectedStudent.tentativesTriche > 0 && (
                            <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                              <p className="font-semibold text-yellow-700 mb-2 flex items-center text-sm">
                                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                                Avertissements :
                              </p>
                              <ul className="text-xs sm:text-sm text-yellow-600 space-y-1">
                                {selectedStudent.avertissements && selectedStudent.avertissements.map((warning, idx) => (
                                  <li key={idx}>‚Ä¢ {warning}</li>
                                ))}
                              </ul>
                            </div>
                          )}

                          <div className="mb-4">
                            <div className="flex gap-2 overflow-x-auto pb-2">
                              <button
                                onClick={() => setDetailView('summary')}
                                className={`px-4 py-2 rounded-t-lg font-medium whitespace-nowrap text-sm ${detailView === 'summary' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'}`}
                              >
                                R√©sum√©
                              </button>
                              <button
                                onClick={() => setDetailView('correct')}
                                className={`px-4 py-2 rounded-t-lg font-medium whitespace-nowrap text-sm ${detailView === 'correct' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'}`}
                              >
                                Correctes ({detailedAnswers.correct.length})
                              </button>
                              <button
                                onClick={() => setDetailView('incorrect')}
                                className={`px-4 py-2 rounded-t-lg font-medium whitespace-nowrap text-sm ${detailView === 'incorrect' ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700'}`}
                              >
                                Incorrectes ({detailedAnswers.incorrect.length})
                              </button>
                              <button
                                onClick={() => setDetailView('unanswered')}
                                className={`px-4 py-2 rounded-t-lg font-medium whitespace-nowrap text-sm ${detailView === 'unanswered' ? 'bg-gray-600 text-white' : 'bg-gray-200 text-gray-700'}`}
                              >
                                Non r√©pondues ({detailedAnswers.unanswered.length})
                              </button>
                            </div>
                          </div>

                          <div className="max-h-96 overflow-y-auto">
                            {detailView === 'summary' && (
                              <div className="space-y-3">
                                <h3 className="font-bold text-gray-800 mb-2">R√©sum√© des r√©ponses</h3>
                                {selectedStudent.detailsReponses && selectedStudent.detailsReponses.map((detail, idx) => (
                                  <div key={idx} className={`p-3 rounded border-l-4 ${detail.estCorrecte ? 'border-green-500 bg-green-50' : detail.reponse === -1 ? 'border-gray-400 bg-gray-50' : 'border-red-500 bg-red-50'}`}>
                                    <div className="flex justify-between items-start">
                                      <span className="font-semibold text-sm">Question {detail.question}</span>
                                      <span className={`text-xs px-2 py-1 rounded ${detail.estCorrecte ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`}>
                                        {detail.points} pts
                                      </span>
                                    </div>
                                    <p className="text-xs text-gray-600 mt-1">{detail.difficulte}</p>
                                  </div>
                                ))}
                              </div>
                            )}

                            {detailView === 'correct' && (
                              <div className="space-y-4">
                                {detailedAnswers.correct.length === 0 ? (
                                  <p className="text-center text-gray-500 py-8">Aucune r√©ponse correcte</p>
                                ) : (
                                  detailedAnswers.correct.map((answer, idx) => (
                                    <div key={idx} className="border-l-4 border-green-500 bg-green-50 p-4 rounded">
                                      <div className="flex justify-between items-start mb-2">
                                        <span className="font-bold text-gray-800">Question {answer.question}</span>
                                        <span className="text-xs bg-green-600 text-white px-2 py-1 rounded">{answer.points} pts</span>
                                      </div>
                                      <p className="text-sm text-gray-700 mb-2">{answer.questionData.question}</p>
                                      <div className="bg-gray-900 text-green-400 p-2 rounded font-mono text-xs overflow-x-auto mb-2">
                                        <pre>{answer.questionData.code}</pre>
                                      </div>
                                      <div className="text-green-700 text-sm flex items-center gap-2">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                        </svg>
                                        <span className="font-semibold">{answer.questionData.options[answer.correct]}</span>
                                      </div>
                                    </div>
                                  ))
                                )}
                              </div>
                            )}

                            {detailView === 'incorrect' && (
                              <div className="space-y-4">
                                {detailedAnswers.incorrect.length === 0 ? (
                                  <p className="text-center text-gray-500 py-8">Aucune r√©ponse incorrecte</p>
                                ) : (
                                  detailedAnswers.incorrect.map((answer, idx) => (
                                    <div key={idx} className="border-l-4 border-red-500 bg-red-50 p-4 rounded">
                                      <div className="flex justify-between items-start mb-2">
                                        <span className="font-bold text-gray-800">Question {answer.question}</span>
                                        <span className="text-xs bg-red-600 text-white px-2 py-1 rounded">0 / {answer.questionData.points} pts</span>
                                      </div>
                                      <p className="text-sm text-gray-700 mb-2">{answer.questionData.question}</p>
                                      <div className="bg-gray-900 text-green-400 p-2 rounded font-mono text-xs overflow-x-auto mb-2">
                                        <pre>{answer.questionData.code}</pre>
                                      </div>
                                      <div className="space-y-2">
                                        <div className="text-red-700 text-sm flex items-center gap-2">
                                          <svg className="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                          </svg>
                                          <div>
                                            <span className="font-semibold">R√©ponse √©tudiant : </span>
                                            <span>{answer.questionData.options[answer.reponse]}</span>
                                          </div>
                                        </div>
                                        <div className="text-green-700 text-sm flex items-center gap-2">
                                          <svg className="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                          </svg>
                                          <div>
                                            <span className="font-semibold">Bonne r√©ponse : </span>
                                            <span>{answer.questionData.options[answer.correct]}</span>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  ))
                                )}
                              </div>
                            )}

                            {detailView === 'unanswered' && (
                              <div className="space-y-4">
                                {detailedAnswers.unanswered.length === 0 ? (
                                  <p className="text-center text-gray-500 py-8">Toutes les questions ont √©t√© r√©pondues</p>
                                ) : (
                                  detailedAnswers.unanswered.map((answer, idx) => (
                                    <div key={idx} className="border-l-4 border-gray-400 bg-gray-50 p-4 rounded">
                                      <div className="flex justify-between items-start mb-2">
                                        <span className="font-bold text-gray-800">Question {answer.question}</span>
                                        <span className="text-xs bg-gray-600 text-white px-2 py-1 rounded">0 / {answer.questionData.points} pts</span>
                                      </div>
                                      <p className="text-sm text-gray-700 mb-2">{answer.questionData.question}</p>
                                      <div className="bg-gray-900 text-green-400 p-2 rounded font-mono text-xs overflow-x-auto mb-2">
                                        <pre>{answer.questionData.code}</pre>
                                      </div>
                                      <div className="text-green-700 text-sm flex items-center gap-2">
                                        <svg className="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                        </svg>
                                        <div>
                                          <span className="font-semibold">Bonne r√©ponse : </span>
                                          <span>{answer.questionData.options[answer.correct]}</span>
                                        </div>
                                      </div>
                                    </div>
                                  ))
                                )}
                              </div>
                            )}
                          </div>

                          <div className="flex flex-col sm:flex-row gap-3 mt-6">
                            <button onClick={() => exportDetailedReport(selectedStudent)} className="flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm sm:text-base">
                              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                              </svg>
                              Rapport
                            </button>
                            <button onClick={() => setSelectedStudent(null)} className="px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm sm:text-base">
                              Fermer
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  );
                })()}
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminDashboard />);
    </script>
</body>
</html>
